myjQuery="undefined"!=typeof myjQuery?myjQuery:jQuery,myjQuery(function(){!function($){function move_mv_dlg(){$(".mv_dlg").css("top",parseFloat($(".mv_dlg").css("top"))+17),$(".mv_dlg").css("left",parseFloat($(".mv_dlg").css("left"))-29)}function adaptWH(){$(".rcalendar").each(function(){$(this).find(".ui-datepicker").css("width","");var h=0,w=0;$(this).find(".ui-datepicker-group").each(function(){h<1*$(this).css("height").replace("px","")&&(h=1*$(this).css("height").replace("px",""))}),$(this).find(".ui-datepicker-group").each(function(){w<1*$(this).css("width").replace("px","")&&(w=1*$(this).css("width").replace("px",""))}),0!=h&&$(this).find(".ui-datepicker-group").each(function(){$(this).css("height",h+"px")}),0!=w&&$(this).find(".ui-datepicker-group").each(function(){$(this).css("width",w+"px")})})}function cleanDatepicker(){var old_fn=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){old_fn.call(this,inst),adaptWH()}}$.fn.rcalendar=function(options){var opt=$.extend({},{title:"",colors:["FFF","FCC","FC9","FF9","FFC","9F9","9FF","CFF","CCF","FCF","CCC","F66","F96","FF6","FF3","6F9","3FF","6FF","99F","F9F","BBB","F00","F90","FC6","FF0","3F3","6CC","3CF","66C","C6C","999","C00","F60","FC3","FC0","3C0","0CC","36F","63F","C3C","666","900","C60","C93","990","090","399","33F","60C","939","333","600","930","963","660","060","366","009","339","636","000","300","630","633","330","030","033","006","309","303"],defaultColor:"F66",partial_colors:["CCC","F66","FF6","6F9","6FF","F9F","999","C00","FC3","3C0","36F","C3C","333","600","963","060","009","636"],partial_defaultColor:"F66",separator2:" - ",ajaxURL:pathCalendar,dialogWidth:400,edition:!0,readonly:!1,partialDate:!0,workingDates:[1,1,1,1,1,1,1],holidayDates:[],startReservationWeekly:[1,1,1,1,1,1,1],startReservationDates:[],fixedReservationDates:!1,fixedReservationDates_length:0,firstDay:0,language:"",dformat:"mm/dd/yy",minDate:"",maxDate:"",showTooltipOnMouseOver:!1,numberOfMonths:1},options,!0);opt.edition&&(opt.showTooltipOnMouseOver=!0),opt.partialDate&&(opt.colors=opt.partial_colors,opt.defaultColor=opt.partial_defaultColor),opt.id=$(this).attr("id");var id=$(this).attr("id"),timeOut=!0,data=new Array;$("#"+opt.id).html('<div class="dp" id="dp'+opt.id+'"></div><input type="hidden" name="selDay_start'+opt.id+'" id="selDay_start'+opt.id+'" /><input type="hidden" name="selMonth_start'+opt.id+'" id="selMonth_start'+opt.id+'" /><input type="hidden" name="selYear_start'+opt.id+'" id="selYear_start'+opt.id+'" /><input type="hidden" name="selDay_end'+opt.id+'" id="selDay_end'+opt.id+'" /><input type="hidden" name="selMonth_end'+opt.id+'" id="selMonth_end'+opt.id+'" /><input type="hidden" name="selYear_end'+opt.id+'" id="selYear_end'+opt.id+'" />');var selectedDates={l:"",u:""},dateToStr=function(d1,d2,dformat){var str=$.datepicker.formatDate(dformat,d1);return d1.toString()!=d2.toString()&&(str+=opt.separator2+$.datepicker.formatDate(dformat,d2)),str},setHiddenFields=function(dl,du){$("#selDay_start"+opt.id).val(""==dl?"":dl.getDate()),$("#selMonth_start"+opt.id).val(""==dl?"":dl.getMonth()+1),$("#selYear_start"+opt.id).val(""==dl?"":dl.getFullYear()),$("#selDay_end"+opt.id).val(""==du?"":du.getDate()),$("#selMonth_end"+opt.id).val(""==du?"":du.getMonth()+1),$("#selYear_end"+opt.id).val(""==du?"":du.getFullYear())},showDialogEdition=function(td,eventText,classn){$(".myover").remove(),$(".myoverAdd").dialog("close"),td.append('<div class="'+classn+'" >'+eventText+"</div>"),$("."+classn).dialog({width:opt.dialogWidth,height:300,close:function(event,ui){$(this).hasClass("myoverAdd")&&($(".myoverAdd").remove(),selectedDates.l="",selectedDates.u="",setHiddenFields(selectedDates.l,selectedDates.u),render())},position:{my:"left top",at:"center bottom",collision:"fit",of:$("."+classn).parent()}}).addClass("mv_dlg_nmonth").parent().addClass("mv_dlg"),$('<div id="mv_corner" />').appendTo($(".mv_dlg .ui-dialog-titlebar")),move_mv_dlg(),$(".comboColor").click(function(){$(this).find(".listColor").css("display","")}),$(".comboColor .listColor div").click(function(){var c=$(this).attr("c");return $(this).parent().css("display","none"),$(this).parent().parent().css("background","#"+c).attr("c",c),!1}),$(".bCancelEvent").click(function(){try{$(".myover").dialog("close"),$(".myoverAdd").dialog("close")}catch(e){}return!1}),$(".bSaveEvent").click(function(){return saveData($(this).parent().parent().parent().find(".eIndex").val(),$(this).parent().parent().find(".eTitle").val(),$(this).parent().parent().find(".eDesc").val(),$(this).parent().parent().find(".comboColor").attr("c")),$(".myover").remove(),$(".myoverAdd").remove(),!1})},getEventEdition=function(d){for(var str="",i=0;i<data.length;i++)if(d>=data[i].l&&d<=data[i].u){str+='<div style="border-left:3px solid #'+data[i].c+';padding-left:10px;margin-bottom:10px;">',str+="<div >"+dateToStr(data[i].l,data[i].u,opt.dformat)+"</div>",str+='<div><input type="hidden" class="eIndex" id="eIndex'+data[i].id+'" value="'+i+'"/></div>',str+='<div class="eRead">',str+="<div>"+data[i].title+"</div>",str+="<div>"+data[i].description+"</div>",opt.edition&&(str+='<div ><a href="" class="bEditEvent">Edit Event</a> &nbsp;  &nbsp; <a href="" class="bDelEvent">Delete Event</a></div>'),str+="</div>",str+='<div class="eWrite" style="display:none">',str+='<div class="comboColor" style="background:#'+data[i].c+'" c="'+data[i].c+'"><div class="listColor '+(opt.partialDate?"partialDate":"")+'" style="display:none">';for(var j=0;j<opt.colors.length;j++)str+='<div style="background:#'+opt.colors[j]+';" c="'+opt.colors[j]+'"></div>';str+="</div></div>",str+='<div><input type="text" class="eTitle" id="eTitle'+data[i].id+'" value="'+data[i].title+'"/></div>',str+='<div><textarea id="eDesc'+data[i].id+'" class="eDesc" >'+data[i].description+"</textarea></div>",str+='<div ><a href="" class="bSaveEvent">Save Event</a> &nbsp;  &nbsp; <a href="" class="bCancelEvent">Cancel</a></div>',str+="</div>",str+="</div>"}return str},getAddEdition=function(){var str="";str+="<div>",str+="<div >"+dateToStr(selectedDates.l,selectedDates.u,opt.dformat)+"</div>",str+='<div><input type="hidden" class="eIndex" id="eIndex" value="-1"/></div>',str+='<div class="eWrite" >',str+='<div class="comboColor" style="background:#'+opt.defaultColor+'" c="'+opt.defaultColor+'"><div class="listColor '+(opt.partialDate?"partialDate":"")+'" style="display:none">';for(var j=0;j<opt.colors.length;j++)str+='<div style="background:#'+opt.colors[j]+';" c="'+opt.colors[j]+'"></div>';return str+="</div></div>",str+='<div>Title<br /><input type="text" class="eTitle" id="eTitle" /></div>',str+='<div>Description<br /><textarea id="eDesc" class="eDesc" ></textarea></div>',str+='<div ><a href="" class="bSaveEvent">Save Event</a> &nbsp;  &nbsp; <a href="" class="bCancelEvent">Cancel</a></div>',str+="</div>",str+="</div>"},render=function(){0==$("#dp"+opt.id).find(".ui-datepicker-calendar").length?createCalendar():(timeOut=!0,$("#dp"+opt.id).datepicker("refresh"))},createCalendar=function(){var dStringClass=new Array;timeOut=!0,$("#dp"+opt.id)&&$("#dp"+opt.id).datepicker("destroy"),cleanDatepicker(),$("#dp"+opt.id).datepicker({showOtherMonths:!1,numberOfMonths:opt.numberOfMonths,onSelect:function(d,inst){if(timeOut=!0,!opt.readonly){var tmpdate;if(opt.fixedReservationDates&&(""==selectedDates.l||""!=selectedDates.l&&""!=selectedDates.u))selectedDates.l=$.datepicker.parseDate(opt.dformat,d),selectedDates.u="",(tmpdate=new Date(selectedDates.l.getTime())).setDate(tmpdate.getDate()+opt.fixedReservationDates_length-(opt.partialDate?0:1)),d=$.datepicker.formatDate(opt.dformat,tmpdate);if(""==selectedDates.l||""!=selectedDates.l&&""!=selectedDates.u)selectedDates.l=$.datepicker.parseDate(opt.dformat,d),selectedDates.u="",setHiddenFields(selectedDates.l,selectedDates.u);else{for(var l=selectedDates.l,u=$.datepicker.parseDate(opt.dformat,d),b=l<=u,dl=b?l:u,du=b?u:l,isPossible=!0,i=0;i<data.length;i++)dl<=data[i].l&&du>=data[i].u&&(isPossible=!1);for(var tmpdate=new Date(dl.getTime());tmpdate<=du;)(0==opt.workingDates[tmpdate.getDay()]||opt.holidayDates.length>0&&"-1"!=opt.holidayDates.indexOf($.datepicker.formatDate("yy-mm-dd",tmpdate)))&&(isPossible=!1,tmpdate=new Date(du.getTime())),tmpdate.setDate(tmpdate.getDate()+1);if(!isPossible||opt.partialDate&&dl.toString()==du.toString())opt.fixedReservationDates?selectedDates.l="":selectedDates.l=$.datepicker.parseDate(opt.dformat,d),selectedDates.u="",setHiddenFields(selectedDates.l,selectedDates.u);else if(selectedDates.l=dl,selectedDates.u=du,setHiddenFields(selectedDates.l,selectedDates.u),opt.edition){var dString=opt.id+"dmy"+(du.getMonth()+1)+"_"+du.getDate()+"_"+du.getFullYear();setTimeout(function(){showDialogEdition($("."+dString),getAddEdition(),"myoverAdd")},100)}}}},onChangeMonthYear:function(){timeOut=!0,$(".myover").remove();try{$(".myoverAdd").dialog("close")}catch(e){}},beforeShowDay:function(d){for(var c="",n=0,co="",co_l="",co_r="",i=0;i<data.length;i++)d>data[i].l&&d<data[i].u?(c="specialDate",n=2,co=data[i].c):d.toString()==data[i].l.toString()?(c="specialDate"+(opt.partialDate?"Left":""),++n>1&&(c="specialDate"+(opt.partialDate?"Middle":"")),opt.partialDate?co_l=data[i].c:co=data[i].c):d.toString()==data[i].u.toString()&&(c="specialDate"+(opt.partialDate?"Right":""),++n>1&&(c="specialDate"+(opt.partialDate?"Middle":"")),opt.partialDate?co_r=data[i].c:co=data[i].c);var r;return d>selectedDates.l&&d<selectedDates.u?(c="specialDate",co=opt.defaultColor):d.toString()==selectedDates.l.toString()&&""==selectedDates.u?(c="specialDateStart",opt.partialDate?co_l=opt.defaultColor:co=opt.defaultColor):d.toString()==selectedDates.l.toString()?(c="specialDate"+(opt.partialDate?"Left":""),opt.partialDate?co_l=opt.defaultColor:co=opt.defaultColor):d.toString()==selectedDates.u.toString()&&(c="specialDate"+(opt.partialDate?"Right":""),opt.partialDate?co_r=opt.defaultColor:co=opt.defaultColor),dString="",""!=c&&(dString=opt.id+"dmy"+(d.getMonth()+1)+"_"+d.getDate()+"_"+d.getFullYear(),dStringClass[dStringClass.length]={d:dString,c:co,co_l:co_l,co_r:co_r,n:n},c+=" dw_active"),timeOut&&(setTimeout(function(){for(var i=0;i<dStringClass.length;i++)$("#"+opt.id+" .specialDate."+dStringClass[i].d).css("background-color","#"+dStringClass[i].c),opt.partialDate&&($("#"+opt.id+" .specialDateRight."+dStringClass[i].d).css("background-color","#"+dStringClass[i].co_r),$("#"+opt.id+" .specialDateLeft."+dStringClass[i].d).css("background-color","#"+dStringClass[i].co_l),dStringClass[i].co_l!=dStringClass[i].co_r?$("#"+opt.id+" .specialDateMiddle."+dStringClass[i].d).css("background-image","url("+pathCalendar_full+"/c_"+dStringClass[i].co_r+"x"+dStringClass[i].co_l+".png)"):$("#"+opt.id+" .specialDateMiddle."+dStringClass[i].d).css("background-color","#"+dStringClass[i].co_l),""!=selectedDates.l&&""!=dStringClass[i].co_r&&1==dStringClass[i].n&&dStringClass[i].d==opt.id+"dmy"+(selectedDates.l.getMonth()+1)+"_"+selectedDates.l.getDate()+"_"+selectedDates.l.getFullYear()&&$("#"+opt.id+" .specialDateLeft."+dStringClass[i].d).css("background-color","none").css("background-image","url("+pathCalendar_full+"/c_"+dStringClass[i].co_r+"x"+opt.defaultColor+".png)"),""!=selectedDates.u&&""!=dStringClass[i].co_l&&1==dStringClass[i].n&&dStringClass[i].d==opt.id+"dmy"+(selectedDates.u.getMonth()+1)+"_"+selectedDates.u.getDate()+"_"+selectedDates.u.getFullYear()&&$("#"+opt.id+" .specialDateRight."+dStringClass[i].d).css("background-color","none").css("background-image","url("+pathCalendar_full+"/c_"+opt.defaultColor+"x"+dStringClass[i].co_l+".png)"));opt.showTooltipOnMouseOver&&$("#"+opt.id+" .ui-datepicker .dw_active").live("mouseover",function(){if(!$(this).hasClass("ui-datepicker-other-month")){var tmpd,d=$(this).attr("class").split("dmy")[1].split("_"),titleDay=new Date(d[2].substring(0,4),d[0]-1,d[1]);$(".myover").remove();var eventText=getEventEdition(titleDay);return""!=eventText&&(showDialogEdition($(this),eventText,"myover"),$(".bEditEvent").click(function(){return $(this).parent().parent().parent().find(".eRead").css("display","none"),$(this).parent().parent().parent().find(".eWrite").css("display",""),!1}),$(".bDelEvent").click(function(){var ind=$(this).parent().parent().parent().find(".eIndex").val();return $.post(opt.ajaxURL+"?dex_bccf_calendar_load2=delete",[{name:"id",value:data[ind].id}],function(d){d&&(d.isSuccess?(data.splice(ind,1),render()):alert("Deleting data error: "+d.msg))},"json"),$(".myover").remove(),!1})),!1}}).live("mouseout",function(){})},1),timeOut=!1),opt.holidayDates.length>0&&"-1"!=opt.holidayDates.indexOf($.datepicker.formatDate("yy-mm-dd",d))&&(dString+=" holidayDates "),[!(n>1&&opt.partialDate||n>0&&!opt.partialDate||0==opt.workingDates[d.getDay()]&&"-1"==opt.startReservationDates.indexOf($.datepicker.formatDate("yy-mm-dd",d))||opt.holidayDates.length>0&&"-1"!=opt.holidayDates.indexOf($.datepicker.formatDate("yy-mm-dd",d))||0==opt.startReservationWeekly[d.getDay()]&&"-1"==opt.startReservationDates.indexOf($.datepicker.formatDate("yy-mm-dd",d))),c+" "+dString]}}),adaptWH(),$("#dp"+opt.id).datepicker("option",$.datepicker.regional[opt.language]),$("#dp"+opt.id).datepicker("option","dateFormat",opt.dformat),$("#dp"+opt.id).datepicker("option","minDate",opt.minDate),$("#dp"+opt.id).datepicker("option","maxDate",opt.maxDate),$("#dp"+opt.id).datepicker("option","firstDay",opt.firstDay),$.datepicker.setDefaults($.datepicker.regional[""]),$(".myover").remove()},loadData,saveData=function(ind,title,desc,c){"-1"==ind?$.post(opt.ajaxURL+"?dex_bccf_calendar_load2=add&id="+opt.calendarId,[{name:"startdate",value:selectedDates.l.getFullYear()+"-"+(selectedDates.l.getMonth()+1)+"-"+selectedDates.l.getDate()},{name:"enddate",value:selectedDates.u.getFullYear()+"-"+(selectedDates.u.getMonth()+1)+"-"+selectedDates.u.getDate()},{name:"title",value:title},{name:"description",value:desc},{name:"color",value:c}],function(d){d&&(d.isSuccess?(d.events[0].l=$.datepicker.parseDate("mm/dd/yy",d.events[0].dl),d.events[0].u=$.datepicker.parseDate("mm/dd/yy",d.events[0].du),data[data.length]=d.events[0],selectedDates.l="",selectedDates.u="",setHiddenFields(selectedDates.l,selectedDates.u),render()):alert("Saving (add) data error: "+d.msg))},"json"):$.post(opt.ajaxURL+"?dex_bccf_calendar_load2=edit",[{name:"id",value:data[ind].id},{name:"title",value:title},{name:"description",value:desc},{name:"color",value:c}],function(d){d&&(d.isSuccess?(data[ind].title=title,data[ind].desc=desc,data[ind].c=c,render()):alert("Saving (edit) data error: "+d.msg))},"json")};return function(){try{$.ajax({type:"POST",async:!1,url:opt.ajaxURL+"?dex_bccf_calendar_load2=list&id="+opt.calendarId,d:[],dataType:"json",dataFilter:function(d,type){return d},success:function(d){if(d.isSuccess){data=d.events;for(var i=0;i<data.length;i++)data[i].l=$.datepicker.parseDate("mm/dd/yy",data[i].dl),data[i].u=$.datepicker.parseDate("mm/dd/yy",data[i].du);render()}else alert("Loading data error: "+d.msg)},error:function(d){try{alert("Loading (processing) data error: "+d)}catch(e){}}})}catch(e){}}(),this},$(window).resize(function(){adaptWH()})}(myjQuery)});